# 週次ドキュメントレビュー結果 - 2026年第06週 (2026-02-09)

## 実施概要

- **レビュー対象**: 95ファイル（過去1週間で更新）
- **実施日**: 2026-02-09
- **対象ドキュメント数**: 71 マークダウンファイル

---

## 発見した問題の一覧

### 🔴 Priority 1: 二重管理の整合性（必須）

#### ❌ 問題1: Jest Coverage Threshold の不一致
- **重要度**: HIGH
- **ファイル**: `services/stock-tracker/core/jest.config.ts`
- **現状**: coverageThreshold が 100% に設定
- **期待値**: 80%（ドキュメント標準）
- **影響**: ドキュメント要件との不整合
- **対応**: `jest.config.ts` の coverageThreshold を 80% に修正

#### ❌ 問題2: rules.md にテストカバレッジ目標の明記なし
- **重要度**: MEDIUM
- **現状**: Issue Template (feature.yml, refactor.yml) で80%を推奨しているが、rules.md に目標値の明記がない
- **期待値**: rules.md にテストカバレッジ目標セクションが必要
- **影響**: Issue Template と rules.md の整合性が取れていない
- **対応**: rules.md にテストカバレッジ目標セクション（4.3節など）を追加

#### 💡 改善提案（優先度: MEDIUM）
1. **PR Template に testing.md への参照を追加**
   - 現状: rules.md, architecture.md, README.md のみ参照
   - 提案: 実装前チェックリストに testing.md へのリンクを追加

2. **Issue Template の bug.yml にテストカバレッジ項目を追加**
   - 現状: feature.yml と refactor.yml にのみテストカバレッジ項目あり
   - 提案: bug.yml にも「修正内容のテストを追加」チェック項目を追加

### 🟡 Priority 2: 構造的整合性（推奨）

#### ❌ 問題3: Monorepo構造のドキュメント更新漏れ
- **重要度**: MEDIUM
- **現状**: 
  - `libs/react`, `libs/aws` が実装されているがドキュメントに未記載
  - admin, auth, codec-converter サービスが実装されているがドキュメントに未記載
  - tools の構造がドキュメントと実装で矛盾（ドキュメント: core/web/batch、実装: 単一パッケージ）
- **対応**: `docs/development/monorepo-structure.md` を実態に合わせて更新

#### 💡 改善提案（優先度: LOW）
1. **codec-converter のテストディレクトリ統一**
   - 現状: `tests/integration`
   - 提案: `tests/e2e` に統一（他サービスとの一貫性）

2. **stock-tracker の Playwright デバイス定義順序**
   - 現状: chromium-mobile → chromium-desktop → webkit-mobile
   - 提案: chromium-desktop → chromium-mobile → webkit-mobile（標準順）
   - 注: 機能的には問題なし

### 🟢 Priority 3: ドキュメント間の整合性（推奨）

#### ❌ 問題4: テストカバレッジ80%の記述で MUST vs SHOULD の混在
- **重要度**: MEDIUM
- **現状**:
  - `rules.md`: MUST（必須）
  - `monorepo-structure.md`: 推奨（libs/* 向け）
  - `testing.md`: 目標
- **影響**: ドキュメント間で強度が統一されていない
- **対応**: 
  - オプション1: すべてMUSTに統一
  - オプション2: 対象範囲を明確化（ビジネスロジックはMUST、UIは推奨など）

#### ❌ 問題5: Stock Tracker サービスの README.md が存在しない
- **重要度**: LOW
- **パス**: `docs/services/stock-tracker/README.md`
- **影響**: 他ドキュメントからの参照ができない
- **対応**: README.md を作成（他サービスと同じ構造）

#### ⚠️ 問題6: ドキュメント間の重複記述（更新時の不整合リスク）
- **重要度**: MEDIUM
- **現状**:

##### 6-1: ブランチ戦略の重複（高リスク）
- **箇所**: `branching.md` + 各サービスの `deployment.md`（5+ ファイル）
- **内容**: `develop`, `integration/**` のデプロイ戦略が各所に記載
- **対応**: 各 deployment.md を参照リンク化、または branching.md への統一

##### 6-2: テスト戦略の重複（中リスク）
- **箇所**: `testing.md` + `service-template.md` + `templates/services/testing.md`
- **内容**: 「スマホファースト」「品質とスピード」「自動化」の基本方針が重複
- **対応**: testing.md を単一ソース化、他は要約 + 参照に変更

##### 6-3: アーキテクチャ層分離の重複（中リスク）
- **箇所**: `architecture.md` + `service-template.md` + `monorepo-structure.md`
- **内容**: core/web/batch の責務説明が重複
- **対応**: architecture.md を単一ソース化、他は参照に統一

##### 6-4: ライブラリ依存関係の重複（中リスク）
- **箇所**: `shared-libraries.md` + `monorepo-structure.md`
- **内容**: `ui → browser → common` の依存関係とサービスからの依存パターンが重複
- **対応**: shared-libraries.md を詳細版、monorepo-structure.md は概要 + 参照に

### 🔵 Priority 4: 実装との乖離（任意）

#### ❌ 問題7: libs/aws の依存関係が不明確
- **重要度**: HIGH
- **現状**: `@nagiyu/aws` が `@nagiyu/common` に依存していない（package.json に記載なし）
- **期待値**: 共通ライブラリは common への依存が必要
- **対応**: `libs/aws/package.json` に `@nagiyu/common` 依存を追加

#### ⚠️ 問題8: codec-converter-web の依存関係が不完全
- **重要度**: MEDIUM
- **現状**: `codec-converter-web` が `@nagiyu/common` を明示的に列記していない
- **期待値**: 他の web パッケージは ui, browser, common を明示
- **対応**: `services/codec-converter/web/package.json` に `@nagiyu/common` を追加

#### ⚠️ 問題9: libs/ui の依存関係がドキュメント表記と異なる
- **重要度**: LOW
- **現状**: `@nagiyu/ui` が `@nagiyu/browser` にのみ依存（common への直接依存なし）
- **ドキュメント**: `ui → browser → common` と記載
- **注**: transitive dependency として解決される可能性あり
- **対応**: ドキュメントで「直接依存」と「間接依存」を明確化、または package.json に common を追加

#### ⚠️ 問題10: services/tools の構造がドキュメントと異なる
- **重要度**: LOW
- **現状**: 単一パッケージ構成（core/web/batch なし）
- **ドキュメント**: 標準パターンは core/web/batch の3パッケージ
- **対応**: 
  - オプション1: tools をドキュメントで例外パターンとして説明
  - オプション2: 標準構造に変更（大規模変更）

---

## ✅ 問題なしの項目

### Priority 1
- ✅ Copilot Instructions ⇄ rules.md の整合性: 完全一致

### Priority 2
- ✅ Branch Strategy: GitHub Actions ワークフローと完全一致
- ✅ Test Device Configuration: Fast/Full CI の分離が正しく実装

### Priority 3
- ✅ ライブラリ依存方向: `ui → browser → common` がすべてのドキュメントで統一
- ✅ MUST/SHOULD ルールの矛盾: ルール間で矛盾なし
- ✅ ドキュメント間のリンク: 99.7%が正常（71ファイル、300+リンク）
- ✅ TypeScript strict mode: 全パッケージで有効

### Priority 4
- ✅ services/*/core の依存関係: UI ライブラリへの依存なし
- ✅ libs/browser の依存関係: libs/common に正しく依存

---

## 推奨対応の優先順位

### 即座に対応すべき（HIGH）
1. ❌ **問題1**: Jest Coverage Threshold を 80% に修正（stock-tracker/core）
2. ❌ **問題7**: libs/aws に @nagiyu/common 依存を追加

### 近日中に対応すべき（MEDIUM）
3. ❌ **問題2**: rules.md にテストカバレッジ目標セクションを追加
4. ❌ **問題3**: monorepo-structure.md を実態に合わせて更新
5. ❌ **問題4**: テストカバレッジ80%の MUST vs SHOULD を統一
6. ⚠️ **問題6**: ドキュメント重複を参照リンク化
7. ⚠️ **問題8**: codec-converter-web に @nagiyu/common を追加

### 余裕があれば対応（LOW）
8. ❌ **問題5**: stock-tracker/README.md を作成
9. 💡 **改善提案**: PR/Issue Template の改善
10. 💡 **改善提案**: テストディレクトリの統一（codec-converter）
11. ⚠️ **問題9**: libs/ui の依存関係を明確化
12. ⚠️ **問題10**: services/tools の構造をドキュメント化

---

## 統計情報

- **検査対象ファイル数**: 71 マークダウンファイル
- **検出した問題数**: 10件（❌: 重要 7件、⚠️: 軽微 3件）
- **改善提案数**: 4件
- **リンクチェック**: 300+ リンク中 1件のリンク切れ（99.7%正常）
- **整合性評価**:
  - Priority 1: 87% (11/12項目で一致)
  - Priority 2: 良好（軽微な不一致あり）
  - Priority 3: 良好（重複記述が主な課題）
  - Priority 4: 概ね良好（依存関係の軽微な不一致あり）

---

## 次回レビューへの申し送り

1. **問題1と問題7は即座に修正**すべき実装とドキュメントの乖離
2. **ドキュメント重複（問題6）**は今後の更新で不整合が生じるリスクが高い
3. **libs/aws, libs/react の未記載**は次回リリース前に monorepo-structure.md に追記必要
4. **方針変更の検出**は今週なし（次回も確認が必要）

---

## レビュー実施者メモ

- 本レビューは GitHub Copilot Agent により自動実行
- 検出された問題は構造的な整合性と二重管理の不整合が中心
- 実装品質自体は高く、主にドキュメント更新の追従漏れが課題
- 次回レビュー予定: 2026-02-16

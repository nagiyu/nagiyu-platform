# Task Proposal Agent - 使用ガイド

## 概要

`task.proposal.agent.md` は、GitHub Issueの内容から実装の指針となる要件・設計ドキュメントを生成する専門エージェントです。

**重要**: このエージェントは**ドキュメント作成専門**であり、実コードの実装は行いません。

## 動作原則

1. **ドキュメント専門**: 実装は行わず、要件と指針の文書化に特化
2. **リポジトリルール準拠**: 4スペースインデント、最小限のルール原則、概念的表現
3. **単体完結**: ドキュメント単体で内容が理解できるよう実コード参照を最小化
4. **次ステップへの橋渡し**: 生成したドキュメントが `task.implement` エージェントの入力となる

## 使用方法

### 基本的な使い方

1. **GitHub Issueに機能要望を記述**:
    ```markdown
    # [Feature] ユーザー認証機能の追加
    
    ## 機能の概要
    ユーザーがメールアドレスとパスワードでログインできるようにする
    
    ## 要件
    ### 機能要件
    - ログイン画面でメールアドレスとパスワードを入力
    - 認証成功時にダッシュボードへリダイレクト
    - セッション管理
    
    ### 非機能要件
    - パスワードはハッシュ化して保存
    - HTTPS必須
    - テストカバレッジ80%以上
    ```

2. **エージェントを呼び出す**:
    ```
    @copilot /task.proposal
    ```

3. **エージェントが自動的に**:
    - Issueの内容を分析
    - タスクタイプを判定（サービス/インフラ/プラットフォーム/ライブラリ）
    - 関連する既存ドキュメントを確認
    - `tasks/`配下に要件・指針ドキュメントを生成
    - 生成されたドキュメントのパスと概要を報告

4. **生成されたドキュメントを確認**:
    - `tasks/issue-{番号}-{短縮名}.md` が作成される
    - 例: `tasks/issue-123-user-auth.md`

5. **実装エージェントに渡す**（オプション）:
    ```
    @copilot /task.implement tasks/issue-123-user-auth.md
    ```

## 生成されるドキュメントの構造

生成されるMarkdownドキュメントには以下のセクションが含まれます:

```markdown
# {機能名}

## 概要
機能の目的と背景

## 関連情報
Issue番号、タスクタイプ、優先度、想定工数

## 要件
### 機能要件
実現すべき機能の一覧

### 非機能要件
品質要件、制約事項

## 実装方針
### アーキテクチャ概要
基本的な設計方針

### ディレクトリ構成
影響を受けるディレクトリとファイル

### 技術的考慮事項
セキュリティ、パフォーマンス、保守性など

## 実装タスク
### Phase 1: {フェーズ名}
チェックリスト形式のタスク一覧

## テスト方針
テスト戦略と受け入れ基準

## デプロイ計画
デプロイ方法と手順の概要

## 関連ドキュメント
参照すべき既存ドキュメントへのリンク

## 未決定事項・課題
実装前に解決すべき課題
```

## タスクタイプ別の特徴

### サービスタスク

新しいアプリケーションや既存サービスへの機能追加:

- **ドキュメント参照**: `docs/services/{サービス名}/`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: デプロイはサービス単位で独立、テストカバレッジ80%必須

**例**:
```markdown
# [Feature] Tools アプリに計算機を追加

## 要件
- 四則演算ができる
- 履歴機能
```

→ `tasks/issue-124-add-calculator.md` が生成される

### インフラタスク

共有インフラ（VPC、IAM等）の構築・管理:

- **ドキュメント参照**: `docs/infra/`, `docs/infra/shared/`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: 全サービスへの影響範囲、CloudFormation/CDKの使用

**例**:
```markdown
# [Feature] 共有VPCとネットワーク構築

## 要件
- パブリック/プライベートサブネット
- NATゲートウェイ
```

→ `tasks/issue-125-shared-vpc.md` が生成される

### プラットフォームタスク

ブランチ戦略、CI/CDなど全体の改善:

- **ドキュメント参照**: `docs/development/`, `docs/`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: 全サービスへの影響、段階的なロールアウト

**例**:
```markdown
# [Feature] Fast CI/Full CI の2段階CI戦略導入

## 要件
- Fast CI: 基本的なチェック
- Full CI: カバレッジ含む完全検証
```

→ `tasks/issue-126-two-tier-ci.md` が生成される

### ライブラリタスク

共通ライブラリ（@nagiyu/common等）の開発:

- **ドキュメント参照**: `docs/libs/`, `docs/development/shared-libraries.md`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: 依存の一方向性（`ui → browser → common`）、パスエイリアス禁止

**例**:
```markdown
# [Feature] @nagiyu/browserにクリップボードユーティリティ追加

## 要件
- read/write機能
- フォールバック処理
```

→ `tasks/issue-127-clipboard-util.md` が生成される

## リポジトリルールの適用

生成されるドキュメントは以下のルールに準拠します:

### 1. フォーマット

- **Markdownインデント**: 4スペース（`.vscode/settings.json`準拠）
- **改行**: Unix形式（LF）
- **文字コード**: UTF-8

### 2. 内容

- **最小限のルール**: 必須事項のみ記載、過度な詳細は避ける
- **概念的表現**: 実コードは記述せず、パターンや方針で表現
- **単体完結**: 実コードへの参照を最小限にし、ドキュメント単体で理解可能に

### 3. プラットフォーム固有ルール

- **TypeScript strict mode**: 型安全性を最優先
- **テストカバレッジ 80%以上**: ビジネスロジックを重点的にテスト
- **ライブラリ依存の一方向性**: `ui → browser → common`（循環禁止）
- **UI層とビジネスロジックの分離**: `components/`, `app/` vs `lib/`
- **エラーメッセージ日本語化**: `ERROR_MESSAGES`オブジェクトで定数化

## 使用例

### 例1: 新サービスの追加

```markdown
# Issue: [Feature] Analytics ダッシュボードの作成

## 概要
各サービスのアクセスログを可視化するダッシュボード

## 要件
- グラフ表示（日次/週次/月次）
- データはDynamoDBから取得
- リアルタイム更新
```

↓

**生成されるドキュメント**: `tasks/issue-150-analytics-dashboard.md`

```markdown
# Analytics ダッシュボード

## 概要
各サービスのアクセスログをグラフで可視化し、データ駆動の意思決定を支援する

## 関連情報
- **Issue**: #150
- **タスクタイプ**: サービス
- **優先度**: Medium
- **想定工数**: Large

## 要件
### 機能要件
- FR1: 日次/週次/月次のアクセス数をグラフ表示
- FR2: DynamoDBからデータを取得
- FR3: リアルタイム更新（WebSocket使用）
...

## 実装方針
### アーキテクチャ概要
- Next.js App Router
- Material UI のグラフコンポーネント
- DynamoDB直接アクセス（サーバーサイド）
- WebSocket接続でリアルタイム更新
...
```

### 例2: インフラの改善

```markdown
# Issue: [Feature] CloudFront導入

## 要件
- 全サービスでCloudFront使用
- SSL/TLS証明書管理
- キャッシュ戦略
```

↓

**生成されるドキュメント**: `tasks/issue-151-cloudfront-setup.md`

```markdown
# CloudFront導入

## 概要
全サービスでCloudFrontを導入し、パフォーマンスとセキュリティを向上

## 関連情報
- **Issue**: #151
- **タスクタイプ**: インフラ
- **優先度**: High
- **想定工数**: Medium

## 要件
### 機能要件
- FR1: 全サービスでCloudFrontディストリビューション作成
- FR2: ACMでSSL/TLS証明書管理
- FR3: カスタムドメイン設定
...

## 実装方針
### アーキテクチャ概要
- CloudFormationで管理
- 各サービス用に個別ディストリビューション
- ACM証明書は共有または個別（設計判断必要）
...
```

### 例3: ライブラリへの機能追加

```markdown
# Issue: [Feature] @nagiyu/commonにdate utilityを追加

## 要件
- フォーマット関数
- パース関数
- タイムゾーン考慮
```

↓

**生成されるドキュメント**: `tasks/issue-152-date-utility.md`

```markdown
# Date Utility追加

## 概要
@nagiyu/commonにdate utilityを追加し、日付操作を標準化

## 関連情報
- **Issue**: #152
- **タスクタイプ**: ライブラリ
- **優先度**: Low
- **想定工数**: Small

## 要件
### 機能要件
- FR1: 日付のフォーマット（ISO8601, カスタム形式）
- FR2: 文字列から日付へのパース
- FR3: タイムゾーン変換
...

## 実装方針
### アーキテクチャ概要
- フレームワーク非依存（`@nagiyu/common`のポリシー）
- 外部ライブラリ不使用（標準APIのみ）
- テストカバレッジ100%
...
```

## ベストプラクティス

### 1. Issue記述のコツ

**Good**:
```markdown
# [Feature] ユーザー認証機能

## 概要
メールアドレスとパスワードでログインできるようにする

## 要件
### 機能要件
- ログイン画面
- セッション管理
- ログアウト

### 非機能要件
- パスワードハッシュ化
- HTTPS必須
```

**Bad**:
```markdown
# ログイン作って

メールとパスワードで
```

### 2. 生成後のレビュー

生成されたドキュメントを必ずレビュー:

- [ ] 要件が網羅されているか
- [ ] 実装方針が妥当か
- [ ] タスク分解が適切か
- [ ] 未決定事項が明確か

必要に応じて手動で修正・追記してから実装に進む。

### 3. 実装エージェントへの連携

生成されたドキュメントを実装エージェントに渡す:

```markdown
# Issue: Phase 1実装

## 親タスク
tasks/issue-123-user-auth.md

## 実装スコープ
Phase 1: ログイン画面の実装

## 関連ドキュメント
- docs/services/auth/requirements.md
- docs/services/auth/architecture.md
```

```
@copilot /task.implement
```

## トラブルシューティング

### Q: ドキュメントが生成されない

A: Issueに以下が記載されているか確認:
- 機能の概要
- 要件（機能要件・非機能要件）

最低限の情報があれば生成可能です。

### Q: 生成されたドキュメントの内容が不十分

A: 生成後に手動で修正・追記してください。
エージェントは基本構造を提供するもので、完璧なドキュメントを保証するものではありません。

### Q: タスクタイプの判定が間違っている

A: 生成されたドキュメントの「関連情報」セクションのタスクタイプを手動で修正してください。

### Q: tasks/ディレクトリが存在しない

A: エージェントが自動的に作成します。手動で作成する必要はありません。

## task.implement エージェントとの連携

`task.proposal`と`task.implement`は連携して動作します:

```
┌─────────────────┐
│ GitHub Issue    │  ← ユーザーが機能要望を記述
│ [Feature] XXX   │
└────────┬────────┘
         │
         ▼
  @copilot /task.proposal
         │
         ▼
┌─────────────────┐
│ task.proposal   │  ← 要件・指針ドキュメントを生成
│ agent           │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ tasks/issue-    │  ← ドキュメント生成
│ 123-xxx.md      │
└────────┬────────┘
         │
         ▼
  @copilot /task.implement tasks/issue-123-xxx.md
         │
         ▼
┌─────────────────┐
│ task.implement  │  ← ドキュメントに従って実装
│ agent           │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Pull Request    │  ← 実装完了
└─────────────────┘
```

## エージェントの制約事項

1. **ドキュメント専門**: 実コードは生成しない
2. **Issue依存**: GitHub Issueの情報が必要
3. **人間の判断**: 生成されたドキュメントの最終確認は人間が行う
4. **概念レベル**: 実装の詳細までは規定しない

## 推奨事項

**新機能開発の流れ**:

1. **Issue作成**: 機能要望を記述
2. **`task.proposal`実行**: 要件・指針ドキュメント生成
3. **レビュー**: 生成されたドキュメントを確認・修正
4. **`task.implement`実行**: ドキュメントに従って実装
5. **PR作成**: 実装完了後にPR作成

この流れにより、ドキュメント駆動開発が実現されます。

---

**作成日**: 2026-01-31
**最終更新日**: 2026-01-31
**用途**: nagiyu-platform の要件・指針ドキュメント生成（GitHub Issue駆動型）

# Task Proposal Agent - 使用ガイド

## 概要

`task.proposal.agent.md` は、GitHub Issueの内容から実装の指針となる要件・設計ドキュメントを生成する専門エージェントです。

**重要**: このエージェントは**ドキュメント作成専門**であり、実コードの実装は行いません。

## 動作原則

1. **ドキュメント専門**: 実装は行わず、要件と指針の文書化に特化
2. **リポジトリルール準拠**: 4スペースインデント、最小限のルール原則、概念的表現
3. **単体完結**: ドキュメント単体で内容が理解できるよう実コード参照を最小化
4. **次ステップへの橋渡し**: 生成したドキュメントが `task.implement` エージェントの入力となる

## 使用方法

### 基本的な使い方

1. **GitHub Issueを作成**:
    リポジトリのIssueテンプレートから機能要望を作成します。

2. **エージェントをIssueにAssign**:
    作成したIssueに本エージェント (`task.proposal`) をAssignします。

3. **エージェントが自動的に**:
    - Issueの内容を分析
    - タスクタイプを判定（サービス/インフラ/プラットフォーム/ライブラリ）
    - 関連する既存ドキュメントを確認
    - `tasks/`配下に要件・指針ドキュメントを生成
    - 生成されたドキュメントのパスと概要を報告

4. **生成されたドキュメントを確認**:
    - `tasks/{タスク名}.md` が作成される
    - 例: `tasks/add-user-auth.md`

5. **実装エージェントにAssign**（オプション）:
    生成されたドキュメントを確認後、`task.implement`エージェントをAssignして実装を開始できます。

## 生成されるドキュメントの構造

生成されるMarkdownドキュメントはIssueの内容に応じて柔軟に構成されます。以下は基本的な例です:

```markdown
# {機能名・タスク名}

## 概要
機能の目的と背景

## 関連情報
Issue番号、タスクタイプ

## 要件
### 機能要件
実現すべき機能の一覧

### 非機能要件
品質要件、制約事項

## 実装のヒント
必要に応じて、実装時の考慮点や方針

## タスク
必要に応じて、実装ステップをチェックリスト形式で記載

## 参考ドキュメント
関連する既存ドキュメント

## 備考・未決定事項
その他メモや不明点
```

**注意**:
- 上記は一例であり、必須の構成ではありません
- Issueの内容や規模に応じて、セクションは増減します
- 新規機能追加なら詳細に、軽微な改修なら簡潔に
- あくまでIssueからの一次受付として、柔軟に対応します
- より詳細な仕様が必要な場合は、後続で`docs/templates/`配下のテンプレートを使用できます

## タスクタイプ別の特徴

### サービスタスク

新しいアプリケーションや既存サービスへの機能追加:

- **ドキュメント参照**: `docs/services/{サービス名}/`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: デプロイはサービス単位で独立、テストカバレッジ80%必須

**例**:
```markdown
# [Feature] Tools アプリに計算機を追加

## 要件
- 四則演算ができる
- 履歴機能
```

→ `tasks/issue-124-add-calculator.md` が生成される

### インフラタスク

共有インフラ（VPC、IAM等）の構築・管理:

- **ドキュメント参照**: `docs/infra/`, `docs/infra/shared/`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: 全サービスへの影響範囲、CloudFormation/CDKの使用

**例**:
```markdown
# [Feature] 共有VPCとネットワーク構築

## 要件
- パブリック/プライベートサブネット
- NATゲートウェイ
```

→ `tasks/issue-125-shared-vpc.md` が生成される

### プラットフォームタスク

ブランチ戦略、CI/CDなど全体の改善:

- **ドキュメント参照**: `docs/development/`, `docs/`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: 全サービスへの影響、段階的なロールアウト

**例**:
```markdown
# [Feature] Fast CI/Full CI の2段階CI戦略導入

## 要件
- Fast CI: 基本的なチェック
- Full CI: カバレッジ含む完全検証
```

→ `tasks/issue-126-two-tier-ci.md` が生成される

### ライブラリタスク

共通ライブラリ（@nagiyu/common等）の開発:

- **ドキュメント参照**: `docs/libs/`, `docs/development/shared-libraries.md`
- **配置先**: `tasks/issue-{番号}-{短縮名}.md`
- **考慮事項**: 依存の一方向性（`ui → browser → common`）、パスエイリアス禁止

**例**:
```markdown
# [Feature] @nagiyu/browserにクリップボードユーティリティ追加

## 要件
- read/write機能
- フォールバック処理
```

→ `tasks/issue-127-clipboard-util.md` が生成される

## リポジトリルールの適用

生成されるドキュメントは以下のルールに準拠します:

### 1. フォーマット

- **Markdownインデント**: 4スペース（`.vscode/settings.json`準拠）
- **改行**: Unix形式（LF）
- **文字コード**: UTF-8

### 2. 内容

- **最小限のルール**: 必須事項のみ記載、過度な詳細は避ける
- **概念的表現**: 実コードは記述せず、パターンや方針で表現
- **単体完結**: 実コードへの参照を最小限にし、ドキュメント単体で理解可能に

### 3. プラットフォーム固有ルール

- **TypeScript strict mode**: 型安全性を最優先
- **テストカバレッジ 80%以上**: ビジネスロジックを重点的にテスト
- **ライブラリ依存の一方向性**: `ui → browser → common`（循環禁止）
- **UI層とビジネスロジックの分離**: `components/`, `app/` vs `lib/`
- **エラーメッセージ日本語化**: `ERROR_MESSAGES`オブジェクトで定数化

## 使用例

### 例1: 新サービスの追加

**Issue作成**: リポジトリのIssueテンプレートから「Analytics ダッシュボード」機能のIssueを作成

**エージェントAssign**: Issueに`task.proposal`をAssign

↓

**生成されるドキュメント**: `tasks/analytics-dashboard.md`

```markdown
# Analytics ダッシュボード

## 概要
各サービスのアクセスログをグラフで可視化し、データ駆動の意思決定を支援する

## 関連情報
- Issue: #150
- タスクタイプ: サービス

## 要件
### 機能要件
- 日次/週次/月次のアクセス数をグラフ表示
- DynamoDBからデータを取得
- リアルタイム更新
...

## 実装のヒント
- Next.js App Router使用
- Material UIのグラフコンポーネント活用
- WebSocket接続でリアルタイム更新
...
```

### 例2: インフラの改善

**Issue作成**: CloudFront導入のIssueを作成

**エージェントAssign**: Issueに`task.proposal`をAssign

↓

**生成されるドキュメント**: `tasks/cloudfront-setup.md`

```markdown
# CloudFront導入

## 概要
全サービスでCloudFrontを導入し、パフォーマンスとセキュリティを向上

## 関連情報
- Issue: #151
- タスクタイプ: インフラ

## 要件
### 機能要件
- 全サービスでCloudFrontディストリビューション作成
- ACMでSSL/TLS証明書管理
- カスタムドメイン設定
...

## 実装のヒント
- CloudFormationで管理
- 各サービス用に個別ディストリビューション
...
```

### 例3: ライブラリへの機能追加

**Issue作成**: @nagiyu/commonにdate utilityを追加するIssueを作成

**エージェントAssign**: Issueに`task.proposal`をAssign

↓

**生成されるドキュメント**: `tasks/date-utility.md`

```markdown
# Date Utility追加

## 概要
@nagiyu/commonにdate utilityを追加し、日付操作を標準化

## 関連情報
- Issue: #152
- タスクタイプ: ライブラリ

## 要件
### 機能要件
- 日付のフォーマット（ISO8601, カスタム形式）
- 文字列から日付へのパース
- タイムゾーン変換
...

## 実装のヒント
- フレームワーク非依存（`@nagiyu/common`のポリシー）
- 外部ライブラリ不使用（標準APIのみ）
- テストカバレッジ100%
...
```

## ベストプラクティス

### 1. Issueの作成

リポジトリのIssueテンプレートを使用してIssueを作成します。テンプレートには必要な情報の記入欄が用意されています。

### 2. 生成後のレビュー

生成されたドキュメントを必ずレビュー:

- [ ] Issueの内容が適切に整理されているか
- [ ] 実装の方向性が妥当か
- [ ] 追加で必要な情報はないか

必要に応じて手動で修正・追記してから実装に進む。

### 3. 詳細設計が必要な場合

大規模な機能や複雑な実装の場合、`docs/templates/`配下のテンプレートを使用してより詳細な設計ドキュメントを作成することを検討します。

### 4. 実装エージェントへの連携

生成されたドキュメントをレビュー後、`task.implement`エージェントをAssignして実装を進めます。

## トラブルシューティング

### Q: ドキュメントが生成されない

A: Issueに以下が記載されているか確認:
- 機能の概要
- 要件（機能要件・非機能要件）

最低限の情報があれば生成可能です。

### Q: 生成されたドキュメントの内容が不十分

A: 生成後に手動で修正・追記してください。
エージェントは基本構造を提供するもので、完璧なドキュメントを保証するものではありません。

### Q: タスクタイプの判定が間違っている

A: 生成されたドキュメントの「関連情報」セクションのタスクタイプを手動で修正してください。

### Q: tasks/ディレクトリが存在しない

A: エージェントが自動的に作成します。手動で作成する必要はありません。

## task.implement エージェントとの連携

`task.proposal`と`task.implement`は連携して動作します:

```
┌─────────────────┐
│ GitHub Issue    │  ← リポジトリのIssueテンプレートから作成
│ (Feature要望)   │
└────────┬────────┘
         │
         ▼ task.proposalをAssign
         │
┌─────────────────┐
│ task.proposal   │  ← 要件・指針ドキュメントを生成
│ agent           │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ tasks/{name}.md │  ← ドキュメント生成
└────────┬────────┘
         │
         ▼ task.implementをAssign
         │
┌─────────────────┐
│ task.implement  │  ← ドキュメントに従って実装
│ agent           │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Pull Request    │  ← 実装完了
└─────────────────┘
```

## エージェントの制約事項

1. **ドキュメント専門**: 実コードは生成しない
2. **Issue依存**: GitHub Issueの情報が必要
3. **人間の判断**: 生成されたドキュメントの最終確認は人間が行う
4. **概念レベル**: 実装の詳細までは規定しない

## 推奨事項

**新機能開発の流れ**:

1. **Issue作成**: リポジトリのIssueテンプレートから機能要望を作成
2. **`task.proposal` Assign**: Issueに本エージェントをAssign
3. **レビュー**: 生成されたドキュメントを確認・修正
4. **詳細設計（必要時）**: `docs/templates/`で詳細仕様作成
5. **`task.implement` Assign**: 実装エージェントをAssign
6. **PR作成**: 実装完了後にPR作成

この流れにより、Issue駆動のドキュメント駆動開発が実現されます。

---

**作成日**: 2026-01-31
**最終更新日**: 2026-01-31
**用途**: nagiyu-platform の要件・指針ドキュメント生成（GitHub Issue駆動型）
